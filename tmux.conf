# -- general -------------------------------------------------------------------

set -g default-terminal "screen-256color" # colors!
setw -g xterm-keys on
set -s escape-time 0                      # fastest command sequences
set -sg repeat-time 600                   # increase repeat timeout
set -s quiet on                           # disable various messages

set -g prefix2 C-w                        # secondary prefix key
bind C-a send-prefix -2

set -g history-limit 5000                 # boost history

# edit configuration
bind e new-window -n '~/.tmux.conf' "sh -c '\${EDITOR:-vim} ~/.tmux.conf && tmux source ~/.tmux.conf && tmux display \"~/.tmux.conf sourced\"'"

# reload configuration
bind r source-file ~/.tmux.conf \; display '~/.tmux.conf sourced'

# -- display -------------------------------------------------------------------

set -g base-index 1         # start windows numbering at 1
setw -g pane-base-index 1   # make pane numbering consistent with windows

setw -g automatic-rename on # rename window to reflect current program
set -g renumber-windows on  # renumber windows when a window is closed

set -g set-titles on                        # set terminal title
set -g set-titles-string '#h ❐ #S ● #I #W'

set -g display-panes-time 800 # slightly longer pane indicators display time
set -g display-time 1000      # slightly longer status messages display time

set -g status-interval 10     # redraw status line every 10 seconds

# 24 hour clock
setw -g clock-mode-style 24

# clear both screen and history
bind -n C-l send-keys C-l \; run 'tmux clear-history'

# activity
set -g monitor-activity on
set -g visual-activity off

# -- navigation ----------------------------------------------------------------

# find session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# pane navigation
bind -r k select-pane -U  # move up (prefix k)
bind -r j select-pane -D  # move down (prefix j)
bind -r h select-pane -L  # move left (prefix h)
bind -r l select-pane -R  # move right (prefix l)
bind > swap-pane -D       # swap current pane with the next one (prefix >)
bind < swap-pane -U       # swap current pane with the previous one (prefix <)

# pane resizing
bind -r ^k resize-pane -U 5 # upward (prefix Ctrl+k)
bind -r ^j resize-pane -D 5 # downward (prefix Ctrl+j)
bind -r ^h resize-pane -L 5 # to the left (prefix Ctrl+h)
bind -r ^l resize-pane -R 5 # to the right (prefix Ctrl+l)

# window navigation
bind Tab last-window      # move to last active window (prefix Tab)

# split window
bind - splitw -v          # vertical split (prefix -)
bind | splitw -h          # horizontal split (prefix |)

# kill window
bind q killw             # kill window (prefix Ctrl+q)

# -- mouse mode ----------------------------------------------------------------

setw -g mode-mouse on
setw -g mouse-resize-pane on
setw -g mouse-select-pane on
setw -g mouse-select-window on

# -- copy mode -----------------------------------------------------------------

setw -g mode-keys vi

bind Enter copy-mode  # enter copy mode
bind Escape copy-mode # enter copy mode
bind b list-buffers   # list paster buffers
bind p paste-buffer   # paste from the top pate buffer

bind -t vi-copy v begin-selection # select (v)
bind -t vi-copy y copy-selection # copy (y)
bind -t vi-copy Escape cancel

# -- man page ------------------------------------------------------------------

bind m command-prompt "splitw -h 'exec man %%'"

# -- status line ---------------------------------------------------------------

# Source tmux statusbar config created by tmuxline.vim
# See more detail about "Airline-tmuxline" settings of my vimconfig (https://github.com/jarsonfang/vimconfig.git)
if-shell "test -f ~/.tmux-statusline.conf" "source ~/.tmux-statusline.conf"

# -- frequently used default bindings  -----------------------------------------

# '$' Rename the current session.
# ',' Rename the current window.
# 's' Select a new session for the attached client interactively.
# 'w' Choose the current window interactively.
# '=' Choose which buffer to paste interactively from a list.
# '#' List all paste buffers.
# '"' Split the current pane into two, top and bottom.
# '%' Split the current pane into two, left and right.
# ';' Move to the previously active pane.
# ':' Enter the tmux command prompt.
# '{' Swap the current pane with the previous pane.
# '}' Swap the current pane with the next pane.
# 'c' Create a new window.
# '&' Kill the current window.
# 'x' Kill the current pane.
# 'd' Detach the current client.
# 'n' Change to the next window.
# 'z' Toggle the current pane zoom.
# '0 to 9' Select windows 0 to 9.
